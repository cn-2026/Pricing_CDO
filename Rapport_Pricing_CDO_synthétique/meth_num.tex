\section{Méthodes numériques}

\subsection{Simulation des taux d'intérêts}

La simulation des trajectoires du taux instantané $r_t$ est une étape essentielle pour la valorisation des produits financiers et l’étude des dynamiques du numéraire. Nous présentons ci-dessous les méthodes de simulation pour les modèles de Vasicek et de CIR.

\subsubsection{Simulation du modèle de Vasicek}

Le modèle de Vasicek est linéaire et admet une solution explicite sous forme d'intégrale stochastique :

\begin{equation}
    r_{t+\Delta t} = r_t e^{-a \Delta t} + b (1 - e^{-a \Delta t}) + \sigma \sqrt{\frac{1 - e^{-2 a \Delta t}}{2a}} \, Z_t,
\end{equation}

où $Z_t \sim \mathcal{N}(0,1)$ est une variable aléatoire normale standard indépendante.

\textbf{Méthode de simulation :}
\begin{enumerate}
    \item Choisir un pas de temps $\Delta t$ et un horizon final $T$.
    \item Initialiser $r_0$.
    \item Générer des variables normales $Z_0, Z_1, \dots$.
    \item Calculer itérativement $r_{t+\Delta t}$ à partir de $r_t$ en utilisant la formule ci-dessus.
\end{enumerate}


\subsubsection{Simulation du modèle CIR}

Le modèle CIR ne possède pas de solution intégrale simple, mais il est possible de simuler $r_t$ de manière exacte grâce à la relation avec la loi du $\chi^2$ non centrale.

\textbf{Méthode de simulation :}
\begin{enumerate}
    \item Choisir un pas de temps $\Delta t$ et un horizon $T$.
    \item Initialiser $r_0 > 0$.
    \item À chaque pas, générer $r_{t+\Delta t}$ selon :
    \[
        r_{t+\Delta t} = \frac{\sigma^2 (1 - e^{-a \Delta t})}{4a} \, \chi^2_{\nu}(\lambda),
    \]
    où $\nu = \frac{4ab}{\sigma^2}$ et $\lambda = \frac{4 a r_t e^{-a \Delta t}}{\sigma^2 (1 - e^{-a \Delta t})}$.
\end{enumerate}


\begin{itemize}
    \item La simulation des trajectoires du modèle de Vasicek est simple et rapide grâce à la solution analytique.
    \item Le modèle CIR garantit la positivité du taux, mais nécessite la génération de variables $\chi^2$ non centrales.
\end{itemize}




\subsection{Calibration des copules}

\subsubsection{Copule gaussienne à un facteur}

Nous cherchons à calibrer une copule gaussienne à partir des spreads
de CDS observés sur les 10 dates fournies. Pour cela nous allons 
chercher à minimiser la norme euclidienne entre les spreads observés et les 
spreads calculés à partir de la copule gaussienne. Nous allons utiliser
la fonction d'optimisation de Scipy \texttt{scipy.optimize.minimize} pour 
trouver les paramètres de la copule gaussienne qui minimisent cette norme.

Afin de simplifier le problème d'optimisation, dans une première étape nous
allons supposer que les corrélations entre les différents CDS sont toutes 
égales, c'est à dire que la matrice de corrélation est de la forme
\begin{equation}
\Sigma = \begin{pmatrix}1 & \rho & \rho & \dots & \rho \\
\rho & 1 & \rho & \dots & \rho \\
\rho & \rho & 1 & \dots & \rho \\
\vdots & \vdots & \vdots & \ddots & \vdots \\
\rho & \rho & \rho & \dots & 1 \\
\end{pmatrix}
\end{equation}
où $\rho$ est le paramètre de corrélation implicite que nous allons calibrer. Nous
sommes donc dans le cas de l'approximation d'un portfolio homogène.

Pour le trouver nous procédons en deux temps, premièrement nous utilisons une
grille de paramètres sur laquelle nous calculons les spreads pour chaque tranche
par une méthode de Monte-Carlo en échantillonnant des temps de défauts du vecteur
aléatoire $(\tau_1, \dots, \tau_n)$. Puis sur une région plus restreinte nous
utilisons l'algorithme de Broyden-Fletcher-Goldfarb-Shanno (BFGS) pour trouver
le minimum de la norme euclidienne entre les spreads observés et les spreads calculés 
à partir de la copule gaussienne. Il s'agit d'une méthode approchée de la méthode
de Newton dite de "quasi-Newton".

\subsubsection{Modèle de Vasicek}

Dans le cas d'un portefolio homogène, grand et suffisament diversifié, il est possible
de faire l'approximation de Vasicek ou LHP (\emph{Large Homogeneous Portfolio}) qui permet de calculer les pertes espérées et donc
les spreads pour chaque tranche en fonction de la corrélation implicite. Pour cela on considère un portefeuille de crédit homogène de taille $n$.
La dépendance des défauts est décrite par un modèle gaussien à un facteur :
\begin{equation}
    X_i = \sqrt{\rho}\,Z + \sqrt{1-\rho}\,\varepsilon_i,
\end{equation}
où $Z,\varepsilon_i \sim \mathcal N(0,1)$ sont indépendantes et $\rho \in (0,1)$. 

\noindent Un défaut avant la date $t$ est défini par
\begin{equation}
\tau_i \le t
\quad \Longleftrightarrow \quad
X_i \le \Phi^{-1}\big(p(t)\big),
\end{equation}
où $p(t)$ est la probabilité de défaut marginale.

\noindent Conditionnellement à $Z=z$, on a
\begin{equation}
X_i \mid Z=z \sim \mathcal N(\sqrt{\rho}\,z,\,1-\rho),
\end{equation}
d’où
\begin{equation}
q(z,t)
:= \mathbb P(\tau_i \le t \mid Z=z)
=
\Phi\!\left(
\frac{\Phi^{-1}(p(t)) - \sqrt{\rho}\,z}{\sqrt{1-\rho}}
\right).
\end{equation}
Or nous savons que pour un notionnel unitaire et un taux de recouvrement constant $R$ la perte du portefeuille est
\begin{equation}
L_N(t)
=
(1-R)\,\frac{1}{N}
\sum_{i=1}^N \mathbf 1_{\{\tau_i \le t\}}.
\end{equation}
Et conditionnellement à $Z=z$, les variables
$\mathbf 1_{\{\tau_i \le t\}}$ sont i.i.d.\ de loi
$\mathrm{Bernoulli}(q(z,t))$.
Ainsi par la loi forte des grands nombres,
\begin{equation}
L_N(t)
\xrightarrow[N\to\infty]{\text{p.s.}}
L(t)
:=
(1-R)\,q(Z,t).
\end{equation}
Nous avons ainsi trouvé une formule explicite pour la perte du portefolio
entier en fonction de la corrélation implicite $\rho$. Pour calculer l'espérance sur $Z$
totale ou bien sur une tranche nous pourrons par exemple utiliser une méthode de
quadrature de Gauss-Hermite.

\begin{figure}[H]
\centering
\includegraphics[width=0.8\textwidth]{images/LHP_corr.png}
\caption{Perte du portefeuille en fonction de la corrélation implicite $\rho$ pour différentes tranches du CDX NA IG Series 19}
\label{fig:vasicek}
\end{figure}







